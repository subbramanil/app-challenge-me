<!DOCTYPE html>
<html>
<head>
	<title>My Web RTC App</title>

	<meta name="keywords" content="JavaScript, WebRTC" />
	<meta name="description" content="WebRTC codelab" />
	<!-- <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1"> -->


	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />

	<style type="text/css">
		.blocks{
			margin: 10px;
			border: none;
		}

		video {
		  width: 307px;
		  height: 250px;
		  background: rgba(255,255,255,0.5);
		  border: 1px solid #ccc;
		}
		.grayscale {
		  +filter: grayscale(1);
		}
		.sepia {
		  +filter: sepia(1);
		}
		.blur {
		  +filter: blur(3px);
		}
		
		video {
		  -webkit-filter: grayscale(1);
		}
	</style>
</head>
<body>
	<div class="panel panel-primary col-md-6">
		<div class="panel-heading">
			My Web RTC App
		</div>
		<div class="panel-body">
			<video></video>
		</div>
		<div class="panel-footer">
			<button class="btn btn-success" type="button" id="captureBtn">
        		<span class="glyphicon glyphicon-camera" aria-hidden="true"></span>
        	</button>
		</div>
	</div>
	<div class="panel panel-primary col-md-6">
		<div class="panel-heading">
			Screenshot
		</div>
		<div class="panel-body">
			<img src="">
			<canvas style="display:none;"></canvas>
		</div>
		<!-- <div class="panel-footer">
			<button class="btn btn-success" type="button" id="refreshBtn">
        		<span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
        	</button>
		</div> -->
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src='lib/adapter.js'></script>
	<script type="text/javascript">

		var canvas = document.querySelector('canvas');
  		var ctx = canvas.getContext('2d');
  		var video = document.querySelector("video");
  		var mediaStream = null;

  		var idx = 0;
		var filters = ['grayscale', 'sepia', 'blur', 'brightness',
		               'contrast', 'hue-rotate', 'hue-rotate2',
		               'hue-rotate3', 'saturate', 'invert', ''];

  		var constraints = {
			video: true
        };

        var hdConstraints = {
			video: {
		    	mandatory: {
		      		minWidth: 1280,
		      		minHeight: 720
		    	}
		  	}
		};

		var vgaConstraints = {
			video: {
		    	mandatory: {
		      		minWidth: 640,
		      		minHeight: 360
		    	}
		  	}
		};

		var minConstraints = {
			video: {
		    	mandatory: {
		      		minWidth: 500,
		      		minHeight: 300
		    	}
		  	}
		};


		$(document).ready(function(){
			console.log("Ready");
			$('#captureBtn').click(snapshot);
			console.log(""+video.width+" "+ video.height);
		});

		function hasGetUserMedia() {
			return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
		        	navigator.mozGetUserMedia || navigator.msGetUserMedia);
		}

		if (hasGetUserMedia()) {
			console.log("Your Browser is : "+navigator.userAgent);
			console.log("getUserMedia() is supported in your browser");
			console.log("More info about the browser: ");
			console.log(navigator);
			navigator.getUserMedia = navigator.getUserMedia ||
								navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
		} else {
			alert('getUserMedia() is not supported in your browser');
		}

		function successCallback(localMediaStream) {
			console.log("Success Callback method"+ navigator.getUserMedia);
			window.stream = localMediaStream; // stream available to console
			mediaStream = localMediaStream;
			console.log(stream);
			console.log(stream.getVideoTracks());
			// stream.stop();
			// console.log("stream stopped");
			video.src = window.URL.createObjectURL(localMediaStream);
			video.play();			
		}

		function errorCallback(error){
			console.log("Error Callback method");
			console.log("navigator.getUserMedia error: ", error);

			//video.src = 'fallbackvideo.webm';

		}

		// document.querySelector('img').addEventListener(
  //   			'click', changeFilter, false);
		navigator.getUserMedia(constraints, successCallback, errorCallback);

		function snapshot() {
			console.log("capturing...");
		    if (mediaStream) {
	      		ctx.drawImage(video, 0, 0);
	      		// "image/webp" works in Chrome.
	      		// Other browsers will fall back to image/png.
	      		console.log(document.querySelector('img'));
	      		document.querySelector('img').src = canvas.toDataURL('image/webp');
		    }
		    console.log("capturing done!!");
		}

		// function changeFilter(e) {
	 //  		var el = e.target;
	 // 		el.className = '';
	 //    	var effect = filters[idx++ % filters.length]; // loop through filters.
	 //  		if (effect) {
	 //    		el.classList.add(effect);
	 //  		}
		// }


		// window.AudioContext = window.AudioContext ||
		//               window.webkitAudioContext;

		// var context = new AudioContext();

		// navigator.getUserMedia({audio: true}, function(stream) {
		// 	var microphone = context.createMediaStreamSource(stream);
		// 	var filter = context.createBiquadFilter();
		// 	// microphone -> filter -> destination.
		// 	microphone.connect(filter);
		// 	filter.connect(context.destination);
		// }, errorCallback);

	</script>

</body>
</html>